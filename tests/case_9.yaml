---
general:
  tmp_dir: /tmp
tasks:
  - name: T1
    subtask:
      - name: T1ST1
        variables:
          V1: T1ST1.A
          V2: T1ST1.A
      - name: T1ST2
        variables:
          V1: T1ST2.A
          V2: T1ST2.B
    pipes:
      # Print variables:
      - name: T1P0
        execute: echo -e "T1P0 {{ .date }} {{ .year }}{{ .month }}{{ .day }}"
        variables:
          V3: T1P1.C
      - name: T1P1
        execute: echo -e "T1P1 {{ .V1 }}-{{ .V2 }}-{{ .V3 }}"
        variables:
          V3: T1P1.C

      # Retry command if exit code is different from definition:
      - name: T1P2
        execute: exit 1
        retry:
          attempts: 3
          wait: 1
          exit_code: 1
      - name: T1P4
        execute: exit 1
        retry:
          attempts: 3
          wait: 1
          exit_code: 0

      # Curl to identify external IP address and
      # save JSON output from stdout to variables and
      # retry if fail request:
      - name: curl
        execute: curl --silent ifconfig.me/all.json
        format: JSON
        retry:
          attempts: 1
          wait: 1
      - name: print
        execute: echo -n "{{ .ip_addr }}"

      # Chunk example:
      - name: T2P4
        execute: echo -e "LIMIT {{ .offset }},{{ .limit }};"
        chunk:
          total: 9
          limit: 2
