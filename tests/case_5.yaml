---
tasks:
  - name: check
    loops:
      - name: main
        variables:
          job_url: "https://api.tinybird.co/v0/jobs/2631da76-39a2-451c-9fe1-11f2cf091dd2"
    pipes:
    - name: curl
      execute: curl --silent ifconfig.me/all.json
      format: JSON
      Retry:
        Attempts: 1
        Wait: 1
    - name: check
      execute: >
        curl \
          --silent \
          -H "Authorization: Bearer $TINYBIRD_TOKEN" \
          -X GET "{{ .job_url }}"
      format: JSON
      retry:
        attempts: 10
        wait: 3
